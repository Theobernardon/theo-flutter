name: Builder Flutter Workflow Réutilisable

on:
  workflow_call:
    # Map the workflow outputs to job outputs
    inputs:
      platforms:
        required: true
        type: string
        description: "Liste des plateformes à builder, séparées par des virgules (ex: apk, ios, web)"
      mode:
        required: true
        type: string
        description: "release ou debug"

jobs:  
  matrix:
    strategy:
      matrix:
        platform: ${{ fromJson(inputs.platforms) }} # linux, windows, macos, apk, ios, web
    runs-on: ubuntu-latest
    steps:
      - name: Choix de l'os
        id: setup-os
        run: |
          if [[ "${{ matrix.platform }}" == linux | apk | web ]]; then
            echo "os=ubuntu-latest" >> $GITHUB_OUTPUT
          elif [[ "${{ matrix.platform }}" == windows ]]; then
            echo "os=windows-latest" >> $GITHUB_OUTPUT
          elif [[ "${{ matrix.platform }}" == macos | ios ]]; then
            echo "os=macos-latest" >> $GITHUB_OUTPUT
          else
            echo "os=none" >> $GITHUB_OUTPUT
          fi
      - uses: ./.github/workflows/build-blueprint.yml
        with:
          platform: ${{ matrix.platform }}
          os: ${{ steps.setup-os.outputs.os }}
          mode: ${{ inputs.mode }} # release ou debug