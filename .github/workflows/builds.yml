name: Builder Flutter Workflow Réutilisable

on:
  workflow_call:
    # Map the workflow outputs to job outputs
    inputs:
      platforms:
        required: true
        type: string
        description: "Liste des plateformes à builder (ex: '[\"linux\", \"windows\"]')"
      mode:
        required: true
        type: string
        description: "release ou debug"

jobs:  
  matrix:
    strategy:
      matrix:
        platform: ${{ fromJson(inputs.platforms) }} # '["linux", "windows", "macos", "apk", "ios", "web"]'
        os: [ubuntu-latest, windows-latest, macos-latest]
        exclude:
          # Exclusions des windows:
          - platform: linux
            os: windows-latest
          - platform: macos
            os: windows-latest
          - platform: ios
            os: windows-latest
          - platform: web
            os: windows-latest
          - platform: apk
            os: windows-latest
          # Exclusions des macos:
          - platform: linux
            os: macos-latest
          - platform: windows
            os: macos-latest
          - platform: web
            os: macos-latest
          - platform: apk
            os: macos-latest
          # Exclusions des linux:
          - platform: windows
            os: ubuntu-latest
          - platform: macos
            os: ubuntu-latest
          - platform: ios
            os: ubuntu-latest
    runs-on: ${{ matrix.os }}
    steps:
      - uses: Theobernardon/theo-flutter/.github/actions/flutter-builder@main
        with:
          platform: ${{ matrix.platform }}
          mode: ${{ inputs.mode }} # release ou debug