name: Builder Flutter blueprint Workflow R√©utilisable

on:
  workflow_call:
    # Map the workflow outputs to job outputs
    inputs:
      platform:
        required: true
        type: string
        description: "plateforme √† builder"
      os:
        required: true
        type: string
        description: "os √† utiliser pour builder"
      path:
        required: true
        type: string
        description: "chemin de la build"

jobs:
  Build:
    name: üöÄ
    runs-on: ${{ inputs.os }}
    steps:
      # 1Ô∏è‚É£ - Cloner ton code source
      - name: Checkout code
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ - Installer Flutter avec pubspec.yaml, et cache automatique
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: stable # Utilise le canal stable pour la version de Flutter
          flutter-version-file: pubspec.yaml
          cache: true # Active le cache pub + flutter automatiquement

      # 3Ô∏è‚É£ - R√©cup√©rer les d√©pendances Dart/Flutter
      - name: Install dependencies
        run: flutter pub get

      # 4Ô∏è‚É£ - Installer les d√©pendances n√©cessaires pour Linux si on build sur Linux
      - name: Installer les d√©pendances Linux
        if: inputs.os == 'ubuntu-latest'
        run: sudo apt-get update && sudo apt-get install -y libgtk-3-dev libglib2.0-dev

      # 5Ô∏è‚É£ - Builder ton application pour la plateforme sp√©cifi√©e
      - name: Build for ${{ inputs.platform }}
        run: flutter build ${{ inputs.platform }}

      # 6Ô∏è‚É£ - Archiver les artefacts de la build pour la plateforme sp√©cifi√©e
      - name: Archive ${{ inputs.platform }} build artifacts
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: flutter-build-${{ inputs.platform }}
          path: ${{ inputs.path }}
