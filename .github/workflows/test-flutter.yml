name: Test et Analyse Flutter Workflow R√©utilisable

on:
  workflow_call:

jobs:
  # Dans un premier temps on fait l'analyse du code et les tests unitaires
  Analyse-et-tests:
    name: üö¶ tests
    # D√©finit les syst√®mes d'exploitation sur lesquels ex√©cuter le job
    runs-on: ubuntu-latest
    steps:
      - name: 1Ô∏è‚É£ - Cloner code source
        uses: actions/checkout@v4

      - name: 2Ô∏è‚É£ - Installer Flutter avec pubspec.yaml, et cache automatique
        uses: subosito/flutter-action@v2
        with:
          flutter-version-file: pubspec.yaml
          cache: true # Active le cache pub + flutter automatiquement

      - name: 3Ô∏è‚É£ - R√©cup√©rer les d√©pendances Dart/Flutter
        run: flutter pub get

      - name: 4Ô∏è‚É£ - V√©rifiez que le code est proprement format√©
        run: dart format --set-exit-if-changed .

      - name: 5Ô∏è‚É£ - V√©rifier que le code est propre (analyse statique)
        run: flutter analyze

      - name: 6Ô∏è‚É£ - Ex√©cuter les tests unitaires
        run: flutter test
